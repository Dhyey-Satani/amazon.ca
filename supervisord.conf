[supervisord]
nodaemon=true
user=root
# Improved logging for debugging
loglevel=info
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10

[program:nginx]
command=nginx -g "daemon off;"
autorestart=true
stdout_logfile=/var/log/nginx/access.log
stderr_logfile=/var/log/nginx/error.log
# Restart nginx if it fails
startretries=3
# Wait for API to start first
priority=200

[program:api]
command=python /app/api_bot.py
directory=/app
autorestart=true
user=botuser
# Capture all output to supervisor logs for debugging
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
# Also log to files
stdout_logfile_backups=0
stderr_logfile_backups=0
# API runs on internal port 8081, nginx proxies to it
environment=PORT=8081,HOME=/app,PYTHONPATH=/app,PATH=/usr/local/bin:/usr/bin:/bin
# Better API startup handling
startretries=5
startsecs=10
# Start API first
priority=100
# Add startup verification
stdout_events_enabled=true
stderr_events_enabled=true