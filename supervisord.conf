[supervisord]
nodaemon=true
user=root
# Improved logging for debugging
loglevel=info
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10

[program:nginx]
command=nginx -g "daemon off;"
autorestart=true
stdout_logfile=/var/log/nginx/access.log
stderr_logfile=/var/log/nginx/error.log
# Restart nginx if it fails
startretries=3
# Wait for API to start first
priority=200

[program:api]
command=python /app/api_bot.py
directory=/app
autorestart=true
user=botuser
stdout_logfile=/app/logs/api.log
stderr_logfile=/app/logs/api.log
# API runs on internal port 8081, nginx proxies to it
environment=PORT=8081
# Better API startup handling
startretries=5
startsecs=10
# Start API first
priority=100